            
            // Show previous step
            currentStep = step;
            document.getElementById(step${currentStep}).classList.remove('hidden');
            updateStepIndicator(currentStep, true);
        }

        function updateStepIndicator(step, isActive) {
            const indicator = document.getElementById(step${step}-indicator);
            const circle = indicator.querySelector('div');
            const text = indicator.querySelector('span');
            
            if (isActive) {
                circle.classList.remove('bg-gray-300', 'text-gray-600');
                circle.classList.add('bg-red-600', 'text-white');
                text.classList.remove('text-gray-500');
                text.classList.add('text-red-600');
            } else {
                circle.classList.remove('bg-red-600', 'text-white');
                circle.classList.add('bg-gray-300', 'text-gray-600');
                text.classList.remove('text-red-600');
                text.classList.add('text-gray-500');
            }
        }

        function generateSummary() {
            const teamName = document.getElementById('teamName').value;
            const teamOrigin = document.getElementById('teamOrigin').value;
            const managerName = document.getElementById('managerName').value;
            const managerContact = document.getElementById('managerContact').value;
            const players = [];
            
            for (let i = 1; i <= 12; i++) {
                players.push(document.getElementById(player${i}).value);
            }
            
            let playersHtml = '';
            players.forEach((player, index) => {
                playersHtml += <div class="flex justify-between py-1"><span>${index + 1}. ${player}</span></div>;
            });
            
            document.getElementById('summaryContent').innerHTML = `
                <div class="space-y-4">
                    <div>
                        <strong>Nama Tim:</strong> ${teamName}
                    </div>
                    <div>
                        <strong>Asal Tim:</strong> ${teamOrigin}
                    </div>
                    <div>
                        <strong>Nama Manajer:</strong> ${managerName}
                    </div>
                    <div>
                        <strong>Kontak Manajer:</strong> ${managerContact}
                    </div>
                    <div>
                        <strong>Daftar Pemain:</strong>
                        <div class="mt-2 bg-white rounded p-3 max-h-40 overflow-y-auto">
                            ${playersHtml}
                        </div>
                    </div>
                </div>
            `;
        }

        // Handle form submission
        document.getElementById('registrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const loading = submitBtn.querySelector('.loading');
            
            // Show loading
            loading.classList.add('show');
            submitBtn.disabled = true;

            // Collect form data
            const teamName = document.getElementById('teamName').value;
            const teamOrigin = document.getElementById('teamOrigin').value;
            const managerName = document.getElementById('managerName').value;
            const managerContact = document.getElementById('managerContact').value;
            const players = [];
            
            for (let i = 1; i <= 12; i++) {
                players.push(document.getElementById(player${i}).value);
            }

            const formData = {
                action: 'register',
                teamName: teamName,
                teamOrigin: teamOrigin,
                managerName: managerName,
                managerContact: managerContact,
                players: players
            };

            try {
                const response = await fetch(SPREADSHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                    },
                    body: JSON.stringify(formData)
                });

                // Since we're using no-cors, we can't read the response
                // But we'll assume success if no error is thrown
                alert('âœ… Tim berhasil didaftarkan!\n\nðŸ“‹ Silakan ke menu "Cek Tim" untuk mendownload formulir pendaftaran yang sudah diisi.');
                document.getElementById('registrationForm').reset();
                
                // Reset to step 1
                document.getElementById(step${currentStep}).classList.add('hidden');
                updateStepIndicator(currentStep, false);
                currentStep = 1;
                document.getElementById('step1').classList.remove('hidden');
                updateStepIndicator(1, true);
                
            } catch (error) {
                console.error('Error:', error);
                alert('âŒ Terjadi kesalahan saat mendaftarkan tim. Silakan coba lagi.');
            } finally {
                // Hide loading
                loading.classList.remove('show');
                submitBtn.disabled = false;
            }
        });

        // Load teams
        async function loadTeams() {
            const loadingSpinner = document.getElementById('loadingSpinner');
            const container = document.getElementById('teamsContainer');
            
            loadingSpinner.classList.add('show');
            
            try {
                const response = await fetch(${SPREADSHEET_URL}?action=getTeams);
                const data = await response.json();
                
                container.innerHTML = '';
                
                if (data.teams && data.teams.length > 0) {
                    data.teams.forEach((team, index) => {
                        const teamCard = document.createElement('div');
                        teamCard.className = 'bg-gradient-to-r from-red-50 to-white rounded-lg p-4 border border-red-200';
                        teamCard.innerHTML = `
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0">
                                <div>
                                    <h4 class="font-semibold text-lg text-gray-800">${team.name}</h4>
                                    <p class="text-gray-600">Asal: ${team.origin}</p>
                                    <p class="text-gray-600">Manajer: ${team.manager || 'Tidak tersedia'}</p>
                                    <p class="text-gray-600">Kontak: ${team.contact || 'Tidak tersedia'}</p>
                                </div>
                                <button onclick="showPrintModal('${team.name}', '${team.origin}', '${team.manager || ''}', '${team.contact || ''}', ${JSON.stringify(team.players || []).replace(/"/g, '&quot;')})" 
                                        class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors w-full sm:w-auto">
                                    ðŸ–¨ Download Formulir
                                </button>
                            </div>
                        `;
                        container.appendChild(teamCard);
                    });
                } else {
                    container.innerHTML = '<p class="text-center text-gray-500 py-8">Belum ada tim yang terdaftar.</p>';
                }
                
            } catch (error) {
                console.error('Error loading teams:', error);
                container.innerHTML = '<p class="text-center text-red-500 py-8">Gagal memuat data tim. Silakan coba lagi.</p>';
            } finally {
                loadingSpinner.classList.remove('show');
            }
        }

        // Show print modal
        function showPrintModal(teamName, teamOrigin, managerName, managerContact, players) {
            const modal = document.getElementById('printModal');
            const content = document.getElementById('printContent');
            
            let playersHtml = '';
            if (players && players.length > 0) {
                players.forEach((player, index) => {
                    playersHtml += `
                        <tr class="border-b">
                            <td class="py-2 px-4 text-center">${index + 1}</td>
                            <td class="py-2 px-4">${player}</td>
                            <td class="py-2 px-4 text-center">_</td>
                        </tr>
                    `;
                });
            }
            
            content.innerHTML = `
                <div class="print-content">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-red-800">FORMULIR PENDAFTARAN</h2>
                        <h3 class="text-xl font-semibold text-red-600">Mini Soccer Liga Champion</h3>
                        <hr class="my-4">
                    </div>
                    
                    <div class="mb-6">
                        <table class="w-full">
                            <tr>
                                <td class="py-2 font-semibold w-32">Nama Tim</td>
                                <td class="py-2">: ${teamName}</td>
                            </tr>
                            <tr>
                                <td class="py-2 font-semibold">Asal Tim</td>
                                <td class="py-2">: ${teamOrigin}</td>
                            </tr>
                            <tr>
                                <td class="py-2 font-semibold">Nama Manajer</td>
                                <td class="py-2">: ${managerName}</td>
                            </tr>
                            <tr>
                                <td class="py-2 font-semibold">Kontak Manajer</td>
                                <td class="py-2">: ${managerContact}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="font-semibold mb-3">Daftar Pemain:</h4>
                        <table class="w-full border border-gray-300">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="py-2 px-4 border-b text-center">No</th>
                                    <th class="py-2 px-4 border-b">Nama Pemain</th>
                                    <th class="py-2 px-4 border-b text-center">Tanda Tangan</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${playersHtml}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mb-8 bg-red-50 p-4 rounded-lg border border-red-200">
                        <h4 class="font-semibold mb-3 text-red-800">Biaya Pendaftaran:</h4>
                        <div class="flex items-center space-x-4">
                            <span class="font-medium">Rp.</span>
                            <div class="border-b-2 border-gray-400 flex-1 min-w-0" style="border-bottom: 2px solid #666; height: 20px;"></div>
                            <span class="text-sm text-gray-600">(Tuliskan nominal biaya pendaftaran)</span>
                        </div>
                    </div>
                    
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="text-center">
                            <p class="mb-16 font-semibold">Penanggung Jawab Tim</p>
                            <div class="border-b-2 border-gray-400 mb-2" style="border-bottom: 2px solid #666; height: 2px;"></div>
                            <p class="text-sm text-gray-600">Nama & Tanda Tangan</p>
                        </div>
                        <div class="text-center">
                            <p class="mb-16 font-semibold">Panitia Penyelenggara</p>
                            <div class="border-b-2 border-gray-400 mb-2" style="border-bottom: 2px solid #666; height: 2px;"></div>
                            <p class="text-sm text-gray-600">Nama & Tanda Tangan</p>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Close print modal
        function closePrintModal() {
            const modal = document.getElementById('printModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // Print form
        function printForm() {
            const printContent = document.getElementById('printContent').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Formulir Pendaftaran</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            table { border-collapse: collapse; }
                            .print-content { max-width: 800px; margin: 0 auto; }
                            @media print { body { margin: 0; } }
                        </style>
                    </head>
                    <body>
                        ${printContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializePlayers();
            showTab('daftar');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'969ba76fb0985d0f',t:'MTc1NDI4NTMzNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
